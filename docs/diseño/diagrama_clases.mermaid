classDiagram
    
    class ComunicadorAgentes {
        -mensajes
        -agentes_registrados
        +registrar_agente()
        +enviar_mensaje()
        +obtener_historial()
    }
    
    class ContextoHibrido {
        -metadatos
        -perfiles_estudiantes
        -recursos_disponibles
        -restricciones
        -historial_decisiones
        -version
        -timestamp_inicio
        -estado_actual
        -errores
        -validaciones
        -texto_completo
        -historial
        -session_id
        -prompts_realizados
        +actualizar_estado()
        +registrar_decision()
        +validar_coherencia()
        +procesar_respuesta_llm()
        +autodetectar_metadatos()
        +determinar_accion()
        +get_contexto_para_llm()
        +get_resumen_sesion()
        +obtener_resumen()
        +registrar_error()
        +reiniciar()
        +finalizar_proyecto()
    }
    
    class AgenteCoordinador {
        -ollama
        -historial_prompts
        -ejemplos_k
        -contexto_hibrido
        -comunicador
        -agentes_especializados
        -flujo_config
        +_cargar_ejemplos_k()
        +generar_ideas_actividades_hibrido()
        +_crear_prompt_hibrido()
        +_seleccionar_ejemplo_relevante()
        +_parsear_ideas()
        +inicializar_sistema_completo()
        +recoger_informacion_inicial()
        +ejecutar_flujo_orquestado()
        +coordinar_proceso()
    }
    
    class SistemaAgentesABP {
        -coordinador
        -proyecto_actual
        -validado
        +ejecutar_flujo_completo()
        +_mostrar_resumen_proceso()
        +_ejecutar_validacion_mejorada()
        +_crear_proyecto_final()
        +_organizar_fases()
    }
    
    class OllamaIntegrator {
        -host
        -port
        -model
        -embedding_model
        -base_url
        -session
        -ollama_disponible
        +generar_respuesta()
        +generar_embedding()
        +_respuesta_fallback()
    }
    
    class AgenteAnalizadorTareas {
        -ollama
        -embeddings_manager
        +descomponer_actividad()
        +seleccionar_y_adaptar_actividad()
        +_parsear_tareas()
        +_extraer_campo()
        +_extraer_lista()
        +_extraer_numero()
    }

    class EmbeddingsManager {
        -ollama
        -actividades_path
        -actividades
        -embeddings_cache
        +cargar_actividades()
        +encontrar_actividad_similar()
        +_generar_texto_enriquecido()
        +_generar_embeddings_actividades()
        +_enriquecer_prompt_usuario()
        +_calcular_similitud_coseno()
        +_seleccionar_por_palabras_clave()
    }
    
    class AgentePerfiladorEstudiantes {
        -ollama
        -perfiles_base
        +_cargar_perfiles_reales()
        +obtener_perfiles_optimizados()
        +_extraer_fortalezas()
        +_extraer_necesidades_apoyo()
        +analizar_perfiles()
        +_parsear_analisis()
    }
    
    class AgenteOptimizadorAsignaciones {
        -ollama
        -perfiles
        +optimizar_asignaciones()
        +_parsear_asignaciones()
    }
    
    class ValidadorCoherencia {
        +validar_proyecto_completo()
        +_validar_estructura()
        +_validar_coherencia_actividad_perfiles()
        +_validar_asignaciones_capacidades()
        +_validar_inclusion_dua()
        +_validar_equilibrio_carga()
    }
    
    class Actividad {
        -descripcion
        -nivel_educativo
        -competencias_objetivo
        -duracion_estimada
        -tipo_producto
    }
    
    class Estudiante {
        -id
        -nombre
        -fortalezas
        -necesidades_apoyo
        -disponibilidad
        -historial_roles
        -adaptaciones
    }
    
    class Tarea {
        -id
        -descripcion
        -competencias_requeridas
        -complejidad
        -tipo
        -dependencias
        -tiempo_estimado
    }
    
    class ProyectoABP {
        -titulo
        -descripcion
        -duracion
        -competencias_objetivo
        -fases
        -asignaciones
        -recursos
        -evaluacion
        -metadatos
    }
    
    class IteracionPrompt {
        -numero
        -prompt
        -accion
        -metadatos_detectados
        -timestamp
    }
    
    SistemaAgentesABP --> AgenteCoordinador
    
    AgenteCoordinador --> ContextoHibrido
    AgenteCoordinador --> ComunicadorAgentes
    AgenteCoordinador --> ValidadorCoherencia
    AgenteCoordinador --> OllamaIntegrator
    AgenteCoordinador --> AgenteAnalizadorTareas
    AgenteCoordinador --> AgentePerfiladorEstudiantes
    AgenteCoordinador --> AgenteOptimizadorAsignaciones
    
    AgenteAnalizadorTareas --> OllamaIntegrator
    AgenteAnalizadorTareas --> EmbeddingsManager
    AgentePerfiladorEstudiantes --> OllamaIntegrator
    AgenteOptimizadorAsignaciones --> OllamaIntegrator
    
    EmbeddingsManager --> OllamaIntegrator
    
    ComunicadorAgentes --> AgenteAnalizadorTareas
    ComunicadorAgentes --> AgentePerfiladorEstudiantes
    ComunicadorAgentes --> AgenteOptimizadorAsignaciones
    
    ContextoHibrido --> IteracionPrompt